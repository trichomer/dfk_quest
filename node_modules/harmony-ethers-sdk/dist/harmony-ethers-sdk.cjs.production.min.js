"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@ethersproject/address"),e=require("@ethersproject/bytes"),r=require("bech32");require("@ethersproject/wallet");var n=require("@ethersproject/properties"),a=require("@ethersproject/keccak256"),o=require("@ethersproject/units"),i=require("@ethersproject/logger"),s=require("@ethersproject/bignumber"),c=require("@ethersproject/transactions"),u=require("@ethersproject/rlp"),l=require("@ethersproject/constants"),h=require("@ethersproject/providers"),f=require("crypto"),d=require("@ethersproject/web");function p(t,e,r,n,a,o,i){try{var s=t[o](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,a)}function m(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(t){p(o,n,a,i,s,"next",t)}function s(t){p(o,n,a,i,s,"throw",t)}i(void 0)}))}}function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,e,r){return e&&g(t.prototype,e),r&&g(t,r),t}function y(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var x,w,b=(function(t){var e=function(t){var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var a=Object.create((e&&e.prototype instanceof h?e:h).prototype),o=new T(n||[]);return a._invoke=function(t,e,r){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return{value:void 0,done:!0}}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var s=w(i,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,o),a}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function d(){}var p={};s(p,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(N([])));g&&g!==e&&r.call(g,a)&&(p=g);var v=d.prototype=h.prototype=Object.create(p);function y(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){var n;this._invoke=function(a,o){function i(){return new e((function(n,i){!function n(a,o,i,s){var c=u(t[a],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==typeof h&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,i,s)}),(function(t){n("throw",t,i,s)})):e.resolve(h).then((function(t){l.value=t,i(l)}),(function(t){return n("throw",t,i,s)}))}s(c.arg)}(a,o,n,i)}))}return n=n?n.then(i,i):i()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var a=n.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function N(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:R}}function R(){return{value:void 0,done:!0}}return f.prototype=d,s(v,"constructor",d),s(d,"constructor",f),f.displayName=s(d,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,s(t,i,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},y(x.prototype),s(x.prototype,o,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var i=new x(c(e,r,n,a),o);return t.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},y(v),s(v,i,"Generator"),s(v,a,(function(){return this})),s(v,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=N,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return i.type="throw",i.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;k(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:N(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(w={exports:{}}),w.exports),k=function(t){return!!t.match(/^one1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}/)},T=function(t){return!!t.match(/^tone1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}/)},N=function(){function n(t){this.raw=t,this.basic=this.getBasic(this.raw)}return n.isValidBasic=function(t){var e=new n(t);return e.raw===e.basic},n.isValidChecksum=function(t){var e=new n(t);return e.raw===e.checksum},n.isValidBech32=function(t){var e=new n(t);return e.raw===e.bech32},n.isValidBech32TestNet=function(t){var e=new n(t);return e.raw===e.bech32TestNet},n.prototype.getBasic=function(n){if(t.isAddress(n))return t.getAddress(n).substring(2);if(k(n)||T(n)){var a=r.bech32.decode(n),o=a.prefix;if("one"===o||"tone"===o)return t.getAddress(e.hexlify(r.bech32.fromWords(a.words))).substring(2)}throw new Error('"'+n+'" is an invalid address format')},v(n,[{key:"basicHex",get:function(){return e.hexlify(this.basic)}},{key:"checksum",get:function(){return t.getAddress(this.basic)}},{key:"bech32",get:function(){return r.bech32.encode("one",r.bech32.toWords(e.arrayify(this.basic)))}},{key:"bech32TestNet",get:function(){return r.bech32.encode("tone",r.bech32.toWords(e.arrayify(this.basic)))}}]),n}();function R(t){try{return new N(t)}catch(t){throw t}}(x=exports.Directive||(exports.Directive={}))[x.CreateValidator=0]="CreateValidator",x[x.EditValidator=1]="EditValidator",x[x.Delegate=2]="Delegate",x[x.Undelegate=3]="Undelegate",x[x.CollectRewards=4]="CollectRewards";var D=new i.Logger("hmy_transaction/0.0.1"),A=[{name:"nonce",maxLength:32,numeric:!0},{name:"gasPrice",maxLength:32,numeric:!0},{name:"gasLimit",maxLength:32,numeric:!0},{name:"shardID",maxLength:16,numeric:!0},{name:"toShardID",maxLength:16,numeric:!0},{name:"to",length:20},{name:"value",maxLength:32,numeric:!0},{name:"data"}],_={nonce:!0,gasLimit:!0,gasPrice:!0,shardID:!0,toShardID:!0,to:!0,value:!0,data:!0,chainId:!0};function L(t,r){var n=e.stripZeros(s.BigNumber.from(t).toHexString());return n.length>32&&D.throwArgumentError("invalid length for "+r,"transaction:"+r,t),n}function S(t){return"string"==typeof t?[o.parseUnits(t,18).toHexString()]:[s.BigNumber.from(t).toHexString()]}function E(t){var e,r,n,a,o;return[new Uint8Array(Buffer.from(null!=(e=t.name)?e:"")),new Uint8Array(Buffer.from(null!=(r=t.identity)?r:"")),new Uint8Array(Buffer.from(null!=(n=t.website)?n:"")),new Uint8Array(Buffer.from(null!=(a=t.securityContact)?a:"")),new Uint8Array(Buffer.from(null!=(o=t.details)?o:""))]}function F(t){return[S(t.rate),S(t.maxRate),S(t.maxChangeRate)]}function I(t,r){switch(t){case exports.Directive.CreateValidator:var n,a=r;return[R(a.validatorAddress).checksum,E(a.description),F(a.commissionRates),L(a.minSelfDelegation,"minSelfDelegation"),L(a.maxTotalDelegation,"maxTotalDelegation"),a.slotPubKeys.map((function(t){return e.arrayify(t)})),null==(n=a.slotKeySigs)?void 0:n.map((function(t){return e.arrayify(t)})),L(a.amount,"amount")];case exports.Directive.EditValidator:var o=r;return[R(o.validatorAddress).checksum,o.description?E(o.description):[],o.commissionRate?S(o.commissionRate):"0x",o.minSelfDelegation?L(o.minSelfDelegation,"minSelfDelegation"):"0x",o.maxTotalDelegation?L(o.maxTotalDelegation,"maxTotalDelegation"):"0x",o.slotKeyToRemove?e.hexlify(o.slotKeyToRemove):"0x",o.slotKeyToAdd?e.hexlify(o.slotKeyToAdd):"0x",o.slotKeySig?e.hexlify(o.slotKeySig):"0x",null!=o.active?o.active?l.One.toHexString():l.Two.toHexString():l.Zero.toHexString()];case exports.Directive.Delegate:case exports.Directive.Undelegate:var i=r;return[R(i.delegatorAddress).checksum,R(i.validatorAddress).checksum,L(i.amount,"amount")];case exports.Directive.CollectRewards:return[R(r.delegatorAddress).checksum];default:D.throwArgumentError("invalid type","type",e.hexlify(t))}}function B(t,e){return P(t,[0===t.type?"0x":s.BigNumber.from(t.type).toHexString(),I(t.type,t.msg),L(t.nonce||0,"nonce"),L(t.gasPrice||0,"gasPrice"),L(t.gasLimit||0,"gasLimit")],e)}function P(t,r,n){var a=1;if(null!=t.chainId?"number"!=typeof(a=t.chainId)&&D.throwArgumentError("invalid transaction.chainId","transaction",t):n&&!e.isBytesLike(n)&&n.v&&n.v>28&&(a=Math.floor((n.v-35)/2)),r.push(e.hexlify(a)),r.push("0x"),r.push("0x"),!n)return u.encode(r);var o=e.splitSignature(n),i=27+(o.recoveryParam||0);return r.pop(),r.pop(),r.pop(),r.push(e.hexlify(i+=2*a+8)),r.push(e.stripZeros(e.arrayify(o.r)||[])),r.push(e.stripZeros(e.arrayify(o.s)||[])),u.encode(r)}function j(t){return"0x"===t?"":R(t).checksum}function V(t){return"0x"===t?l.Zero:s.BigNumber.from(t)}function O(t){return Buffer.from(e.arrayify(t)).toString()}function C(t){return{name:O(t[0]),identity:O(t[1]),website:O(t[2]),securityContact:O(t[3]),details:O(t[4])}}function q(t){return{rate:t[0],maxRate:t[1],maxChangeRate:t[2]}}function H(t){var e=s.BigNumber.from(t);return e.eq(l.Zero)?null:!!e.eq(l.One)||!e.eq(l.Two)&&null}function M(t,r){switch(t){case exports.Directive.CreateValidator:return{validatorAddress:j(r[0]),description:C(r[1]),commissionRates:q(r[2]),minSelfDelegation:V(r[3]),maxTotalDelegation:V(r[4]),slotPubKeys:r[5],slotKeySigs:r[6],amount:V(r[7])};case exports.Directive.EditValidator:return{validatorAddress:j(r[0]),description:C(r[1]),commissionRate:r[2],minSelfDelegation:V(r[3]),maxTotalDelegation:V(r[4]),slotKeyToRemove:r[5],slotKeyToAdd:r[6],slotKeySig:r[7],active:H(r[8])};case exports.Directive.Undelegate:case exports.Directive.Delegate:return{delegatorAddress:j(r[0]),validatorAddress:j(r[1]),amount:V(r[2])};case exports.Directive.CollectRewards:return{delegatorAddress:j(r[0])};default:return D.throwArgumentError("invalid type","type",e.hexlify(t)),null}}function K(t){5!==t.length&&8!==t.length&&D.throwArgumentError("invalid component count for staking transaction","payload","");var r="0x"===t[0]?0:V(t[0]).toNumber(),n={type:r,msg:M(r,t[1]),nonce:V(t[2]).toNumber(),gasPrice:V(t[3]),gasLimit:V(t[4]),chainId:1};if(5===t.length)return n;try{n.v=s.BigNumber.from(t[5]).toNumber()}catch(t){return n}if(n.r=e.hexZeroPad(t[6],32),n.s=e.hexZeroPad(t[7],32),s.BigNumber.from(n.r).isZero()&&s.BigNumber.from(n.s).isZero())n.chainId=n.v,n.v=0;else{n.chainId=Math.floor((n.v-35)/2);var o=n.v-27,i=t.slice(0,5);i.push(e.hexlify(n.chainId)),i.push("0x"),i.push("0x"),o-=2*n.chainId+8;var l=a.keccak256(u.encode(i));try{n.from=c.recoverAddress(l,{r:e.hexlify(n.r),s:e.hexlify(n.s),recoveryParam:o})}catch(t){}n.hash=a.keccak256(u.encode(t))}return n}function U(t){11!==t.length&&8!==t.length&&D.throwArgumentError("invalid raw transaction","transaction","");var r={nonce:V(t[0]).toNumber(),gasPrice:V(t[1]),gasLimit:V(t[2]),shardID:V(t[3]),toShardID:V(t[4]),to:j(t[5]),value:V(t[6]),data:t[7],chainId:1};if(8===t.length)return r;try{r.v=s.BigNumber.from(t[8]).toNumber()}catch(t){return r}if(r.r=e.hexZeroPad(t[9],32),r.s=e.hexZeroPad(t[10],32),s.BigNumber.from(r.r).isZero()&&s.BigNumber.from(r.s).isZero())r.chainId=r.v,r.v=0;else{r.chainId=Math.floor((r.v-35)/2);var n=r.v-27,o=t.slice(0,8);o.push(e.hexlify(r.chainId)),o.push("0x"),o.push("0x"),n-=2*r.chainId+8;var i=a.keccak256(u.encode(o));try{r.from=c.recoverAddress(i,{r:e.hexlify(r.r),s:e.hexlify(r.s),recoveryParam:n})}catch(t){}r.hash=a.keccak256(u.encode(t))}return r}function Z(t){return U(u.decode(e.arrayify(t)))}function W(t){return K(u.decode(e.arrayify(t)))}var G={CreateValidator:0,EditValidator:1,Delegate:2,Undelegate:3,CollectRewards:4},X=function(t){function e(){return t.call(this)||this}y(e,t);var r=e.prototype;return r.getDefaultFormats=function(){var e=this.number.bind(this),r=this.address.bind(this),a=this.data.bind(this),o=this.hash.bind(this),i=this.bigNumber.bind(this),s=this.decimal.bind(this),c=this.transactionType.bind(this),u=function(t){return t},l=t.prototype.getDefaultFormats.call(this);return delete l.transaction.type,delete l.transaction.accessList,delete l.transactionRequest.type,delete l.transactionRequest.accessList,l.transaction.shardID=e,l.transaction.toShardID=h.Formatter.allowNull(e),l.receipt.type=h.Formatter.allowNull(c),Object.assign(l.block,{nonce:e,epoch:i,viewID:e,mixHash:o,stakingTransactions:h.Formatter.allowNull(h.Formatter.arrayOf(o))}),l.stakingTransaction={hash:o,type:c,blockHash:h.Formatter.allowNull(o,null),blockNumber:h.Formatter.allowNull(e,null),transactionIndex:h.Formatter.allowNull(e,null),confirmations:h.Formatter.allowNull(e,null),gasPrice:i,gasLimit:i,nonce:e,r:h.Formatter.allowNull(this.uint256.bind(this)),s:h.Formatter.allowNull(this.uint256.bind(this)),v:h.Formatter.allowNull(e),raw:h.Formatter.allowNull(a)},Object.assign(l.blockWithTransactions,{nonce:e,epoch:i,viewID:e,mixHash:o,stakingTransactions:h.Formatter.allowNull(h.Formatter.arrayOf(this.stakingTransactionResponse.bind(this)))}),l.cXReceipt={blockHash:o,blockNumber:e,to:r,from:r,shardID:e,toShardID:e,value:i},l.description={name:u,identity:u,website:u,securityContact:u,details:u},l.commissionRate={rate:s,maxRate:s,maxChangeRate:s},l.createValidatorMsg={validatorAddress:r,amount:i,minSelfDelegation:i,maxTotalDelegation:i,slotPubKeys:h.Formatter.arrayOf(u)},l.createValidatorRequestMsg=n.shallowCopy(l.createValidatorMsg),l.createValidatorRequestMsg.slotKeySigs=h.Formatter.arrayOf(u),l.editValidatorMsg={validatorAddress:r,commissionRate:h.Formatter.allowNull(s,"0x0"),minSelfDelegation:h.Formatter.allowNull(i,"0x0"),maxTotalDelegation:h.Formatter.allowNull(i,"0x0"),slotPubKeyToAdd:h.Formatter.allowNull(u,null),slotPubKeyToRemove:h.Formatter.allowNull(u,null)},l.editValidatorRequestMsg=n.shallowCopy(l.editValidatorMsg),l.editValidatorRequestMsg.slotKeySigs=h.Formatter.allowNull(h.Formatter.arrayOf(u),[]),l.editValidatorRequestMsg.active=h.Formatter.allowNull((function(t){return t}),null),l.delegateMsg={delegatorAddress:r,validatorAddress:r,amount:i},l.undelegateMsg={delegatorAddress:r,validatorAddress:r,amount:i},l.collectRewardsMsg={delegatorAddress:r},l.undelegation={amount:u,epoch:e},l.delegation={delegatorAddress:r,validatorAddress:r,amount:u,reward:u,undelegations:h.Formatter.allowNull(h.Formatter.arrayOf((function(t){return h.Formatter.check(l.undelegation,{amount:t.Amount,epoch:t.Epoch})})),[])},l},r.decimal=function(t){return"0x0"===t?null:o.parseUnits(t,18)},r.transaction=function(t){return Z(t)},r.stakingTransaction=function(t){return W(t)},r.transactionType=function(t){var e=t;return"string"==typeof t&&(e=G[t]),this.number(e)},r.msg=function(t,e){switch(t){case exports.Directive.CreateValidator:var r=h.Formatter.check(this.formats.createValidatorMsg,e);return r.commissionRates=h.Formatter.check(this.formats.commissionRate,{rate:o.formatUnits(s.BigNumber.from(e.commissionRate),18),maxRate:o.formatUnits(s.BigNumber.from(e.maxCommissionRate),18),maxChangeRate:o.formatUnits(s.BigNumber.from(e.maxChangeRate),18)}),r.description=h.Formatter.check(this.formats.description,e),r;case exports.Directive.EditValidator:var n=h.Formatter.check(this.formats.editValidatorMsg,e);return n.description=h.Formatter.check(this.formats.description,e),n;case exports.Directive.Delegate:return h.Formatter.check(this.formats.delegateMsg,e);case exports.Directive.Undelegate:return h.Formatter.check(this.formats.undelegateMsg,e);case exports.Directive.CollectRewards:return h.Formatter.check(this.formats.collectRewardsMsg,e);default:throw new Error("Invalid msg type")}},r.address=function(t){return R(t).checksum},r._block=function(e,r){return t.prototype._block.call(this,e,r)},r.block=function(t){return this._block(t,this.formats.block)},r.blockWithTransactions=function(t){return this._block(t,this.formats.blockWithTransactions)},r.transactionResponse=function(t){null!=t.gas&&null==t.gasLimit&&(t.gasLimit=t.gas),null!=t.input&&null==t.data&&(t.data=t.input),null==t.to&&null==t.creates&&(t.creates=this.contractAddress(t));var e=h.Formatter.check(this.formats.transaction,t);return e.blockHash&&"x"===e.blockHash.replace(/0/g,"")&&(e.blockHash=""),e},r.stakingTransactionResponse=function(t){null!=t.gas&&null==t.gasLimit&&(t.gasLimit=t.gas);var e=h.Formatter.check(this.formats.stakingTransaction,t);return e.msg=this.msg(e.type,t.msg),e},r.receipt=function(t){return null!=t.type&&(t.from=t.sender),h.Formatter.check(this.formats.receipt,t)},r.cXReceipt=function(t){return h.Formatter.check(this.formats.cXReceipt,t)},r.delegation=function(t){return h.Formatter.check(this.formats.delegation,{validatorAddress:t.validator_address,delegatorAddress:t.delegator_address,amount:t.amount,reward:t.reward,undelegations:t.Undelegations})},e}(h.Formatter),z=new i.Logger("hmy_provider/0.0.1");function Y(t){return new Promise((function(e){setTimeout(e,t)}))}var J=[{name:"mainnet",chainId:1},{name:"testnet",chainId:2},{name:"localnet",chainId:3}];exports.ApiHarmonyProvider=function(t){function r(e){var r;return(r=t.call(this,e)||this)._nextId=f.randomBytes(1).readUInt8(),r}y(r,t),r.getNetwork=function(t,e){var r,n,a;return"number"==typeof t?{shardID:null!=(r=null==e||null==(n=e.find((function(t){return t.current})))?void 0:n.shardID)?r:0,name:(null!=(a=J.find((function(e){return e.chainId===t})))?a:{name:"unknown"}).name,chainId:t}:t},r.getFormatter=function(){return new X};var a=r.prototype;return a.detectNetwork=function(){var t=m(b.mark((function t(){var e,r,a;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Y(0);case 2:return e=null,t.prev=3,t.next=6,this.send("hmy_chainId",[]);case 6:e=t.sent,t.next=19;break;case 9:return t.prev=9,t.t0=t.catch(3),t.prev=11,t.next=14,this.send("net_version",[]);case 14:e=t.sent,t.next=19;break;case 17:t.prev=17,t.t1=t.catch(11);case 19:if(r=this._shardingStructure){t.next=29;break}return t.prev=21,t.next=24,this.send("hmy_getShardingStructure",[]);case 24:r=t.sent,t.next=29;break;case 27:t.prev=27,t.t2=t.catch(21);case 29:if(null==e){t.next=38;break}return a=n.getStatic(this.constructor,"getNetwork"),t.prev=31,t.abrupt("return",a(s.BigNumber.from(e).toNumber(),r));case 35:return t.prev=35,t.t3=t.catch(31),t.abrupt("return",z.throwError("could not detect network",i.Logger.errors.NETWORK_ERROR,{chainId:e,event:"invalidNetwork",serverError:t.t3}));case 38:return t.abrupt("return",z.throwError("could not detect network",i.Logger.errors.NETWORK_ERROR,{event:"noNetwork"}));case 39:case"end":return t.stop()}}),t,this,[[3,9],[11,17],[21,27],[31,35]])})));return function(){return t.apply(this,arguments)}}(),a.getCirculatingSupply=function(){var t=m(b.mark((function t(){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=o.parseEther,t.next=3,this.send("hmy_getCirculatingSupply",[]);case 3:return t.t1=t.sent,t.abrupt("return",(0,t.t0)(t.t1));case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),a.getTotalSupply=function(){var t=m(b.mark((function t(){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=o.parseEther,t.next=3,this.send("hmy_getTotalSupply",[]);case 3:return t.t1=t.sent,t.abrupt("return",(0,t.t0)(t.t1));case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),a.getEpoch=function(){var t=m(b.mark((function t(){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=this.formatter,t.next=3,this.send("hmy_getEpoch",[]);case 3:return t.t1=t.sent,t.abrupt("return",t.t0.number.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),a.getEpochLastBlock=function(){var t=m(b.mark((function t(e){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=this.formatter,t.next=3,this.send("hmy_epochLastBlock",[e]);case 3:return t.t1=t.sent,t.abrupt("return",t.t0.number.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),a.getLeader=function(){var t=m(b.mark((function t(){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=this.formatter,t.next=3,this.send("hmy_getLeader",[]);case 3:return t.t1=t.sent,t.abrupt("return",t.t0.address.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),a.getValidatorsAddresses=function(){var t=m(b.mark((function t(){var e=this;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send("hmy_getAllValidatorAddresses",[]);case 2:return t.abrupt("return",t.sent.map((function(t){return e.formatter.address(t)})));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),a.getActiveValidatorsAddresses=function(){var t=m(b.mark((function t(){var e=this;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send("hmy_getActiveValidatorAddresses",[]);case 2:return t.abrupt("return",t.sent.map((function(t){return e.formatter.address(t)})));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),a.getDelegationsByValidator=function(){var t=m(b.mark((function t(e){var r=this;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send("hmy_getDelegationsByValidator",[e]);case 2:return t.abrupt("return",t.sent.map((function(t){return r.formatter.delegation(t)})));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),a.getDelegationsByDelegator=function(){var t=m(b.mark((function t(e){var r=this;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send("hmy_getDelegationsByDelegator",[e]);case 2:return t.abrupt("return",t.sent.map((function(t){return r.formatter.delegation(t)})));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),a._wrapTransaction=function(e,r){return t.prototype._wrapTransaction.call(this,e,r)},a._wrapStakingTransaction=function(t,e){var r=t;return r.hash=e||"",r},a.sendTransaction=function(){var t=m(b.mark((function t(r){var n,a;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getNetwork();case 2:return t.t0=e.hexlify,t.next=5,Promise.resolve(r);case 5:return t.t1=t.sent,n=(0,t.t0)(t.t1),a=this.formatter.transaction(r),t.prev=8,t.next=11,this.perform("sendTransaction",{signedTransaction:n});case 11:return t.abrupt("return",this._wrapTransaction(a,t.sent));case 15:throw t.prev=15,t.t2=t.catch(8),t.t2.transaction=a,t.t2.transactionHash=a.hash,t.t2;case 20:case"end":return t.stop()}}),t,this,[[8,15]])})));return function(e){return t.apply(this,arguments)}}(),a.sendStakingTransaction=function(){var t=m(b.mark((function t(r){var n,a;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getNetwork();case 2:return t.t0=e.hexlify,t.next=5,Promise.resolve(r);case 5:return t.t1=t.sent,n=(0,t.t0)(t.t1),a=this.formatter.stakingTransaction(r),t.prev=8,t.next=11,this.perform("sendStackingTransaction",{signedTransaction:n});case 11:return t.abrupt("return",this._wrapStakingTransaction(a,t.sent));case 15:throw t.prev=15,t.t2=t.catch(8),t.t2.transaction=a,t.t2.transactionHash=a.hash,t.t2;case 20:case"end":return t.stop()}}),t,this,[[8,15]])})));return function(e){return t.apply(this,arguments)}}(),a.prepareRequest=function(e,r){switch(e){case"sendStackingTransaction":return["hmy_sendRawStakingTransaction",[r.signedTransaction]];case"getStakingTransaction":return["hmy_getStakingTransactionByHash",[r.transactionHash]];case"getCXTransactionReceipt":return["hmy_getCXReceiptByHash",[r.transactionHash]];default:var n=t.prototype.prepareRequest.call(this,e,r),a=n[0],o=n[1];return a.startsWith("eth")&&(a=a.replace("eth","hmy")),[a,o]}},a._getBlock=function(){var e=m(b.mark((function e(r,n){var a,o,i,s,c;return b.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.prototype._getBlock.call(this,r,n);case 2:if((a=e.sent).shardID=this.network.shardID,!n){e.next=24;break}o=null,i=0;case 7:if(!(i<a.stakingTransactions.length)){e.next=24;break}if(null!=(s=a.stakingTransactions[i]).blockNumber){e.next=13;break}s.confirmations=0,e.next=21;break;case 13:if(null!=s.confirmations){e.next=21;break}if(null!=o){e.next=18;break}return e.next=17,this._getInternalBlockNumber(100+2*this.pollingInterval);case 17:o=e.sent;case 18:(c=o-s.blockNumber+1)<=0&&(c=1),s.confirmations=c;case 21:i++,e.next=7;break;case 24:return e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),a.getBlock=function(t){return this._getBlock(t,!1)},a.getBlockWithTransactions=function(t){return this._getBlock(t,!0)},a.getTransaction=function(e){return t.prototype.getTransaction.call(this,e)},a.getStakingTransaction=function(){var t=m(b.mark((function t(e){var r,n=this;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getNetwork();case 2:return t.next=4,e;case 4:return r={transactionHash:this.formatter.hash(e=t.sent,!0)},t.abrupt("return",d.poll(m(b.mark((function t(){var e,a;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.perform("getStakingTransaction",r);case 2:if(null!=(e=n.formatter.stakingTransactionResponse(t.sent)).blockNumber){t.next=8;break}e.confirmations=0,t.next=15;break;case 8:if(null!=e.confirmations){t.next=15;break}return t.next=11,n._getInternalBlockNumber(100+2*n.pollingInterval);case 11:(a=t.sent-e.blockNumber+1)<=0&&(a=1),e.confirmations=a;case 15:return t.abrupt("return",n._wrapStakingTransaction(e));case 16:case"end":return t.stop()}}),t)}))),{oncePoll:this}));case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),a.getCXTransactionReceipt=function(){var t=m(b.mark((function t(e){var r,n=this;return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getNetwork();case 2:return r={transactionHash:this.formatter.hash(e,!0)},t.abrupt("return",d.poll(m(b.mark((function t(){return b.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.perform("getCXTransactionReceipt",r);case 2:return t.abrupt("return",n.formatter.cXReceipt(t.sent));case 4:case"end":return t.stop()}}),t)}))),{oncePoll:this}));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),v(r,[{key:"network",get:function(){return this._network}}]),r}(h.JsonRpcProvider),exports.HRP="one",exports.HarmonyAddress=N,exports.getAddress=R,exports.isBech32Address=k,exports.isBech32TestNetAddress=T,exports.parse=function(t){var r=e.arrayify(t),n=u.decode(r);return Array.isArray(n[1])?K(n):U(n)},exports.parseStakingTransaction=W,exports.parseTransaction=Z,exports.serialize=function(t,r){return"type"in t?B(t,r):function(t,r){n.checkProperties(t,_);var a=[];return A.forEach((function(r){var n,o=null!=(n=null==t?void 0:t[r.name])?n:[],i={};r.numeric&&(i.hexPad="left"),o=e.arrayify(e.hexlify(o,i)),r.length&&o.length!==r.length&&o.length>0&&D.throwArgumentError("invalid length for "+r.name,"transaction:"+r.name,o),r.maxLength&&(o=e.stripZeros(o)).length>r.maxLength&&D.throwArgumentError("invalid length for "+r.name,"transaction:"+r.name,o),a.push(e.hexlify(o))})),P(t,a,r)}(t,r)},exports.serializeStakingTransaction=B,exports.tHRP="tone";
//# sourceMappingURL=harmony-ethers-sdk.cjs.production.min.js.map
